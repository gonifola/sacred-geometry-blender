import bpy
import bmesh
from mathutils import Vector

# Clear scene
bpy.ops.object.select_all(action='SELECT')
bpy.ops.object.delete(use_global=True)

# ===== PRE-COMPUTED COMPOUND GEOMETRY (VIOLET & GOLD) =====
# DOD edge = 1.000000, ICO edge = 1.618034
# TIP_DOD = 1.618034, TIP_ICO = 2.618034
# 12 pentagon faces, 20 triangle faces
# 64 shared vertices, 120 triangular faces
# All geometry computed offline with numpy â€” zero runtime face-finding

verts = [
    (-0.309017, -0.809017, 0.500000),
    (-0.309017, -0.809017, -0.500000),
    (-0.809017, -0.500000, 0.309017),
    (-0.809017, 0.500000, 0.309017),
    (-0.309017, 0.809017, 0.500000),
    (0.309017, 0.809017, -0.500000),
    (0.809017, 0.500000, -0.309017),
    (0.809017, -0.500000, -0.309017),
    (0.309017, -0.809017, 0.500000),
    (0.000000, -0.500000, 0.809017),
    (-0.500000, -0.309017, 0.809017),
    (-0.500000, 0.309017, 0.809017),
    (0.000000, 0.500000, 0.809017),
    (0.500000, 0.309017, 0.809017),
    (0.500000, -0.309017, 0.809017),
    (0.000000, -0.309017, 1.309017),
    (-0.809017, -0.500000, -0.309017),
    (-0.309017, -0.809017, 0.500000),
    (0.309017, -0.809017, -0.500000),
    (0.809017, -0.500000, 0.309017),
    (0.500000, -0.309017, 0.809017),
    (0.000000, -0.809017, 0.500000),
    (-0.500000, -0.309017, -0.809017),
    (-0.809017, -0.500000, -0.309017),
    (-0.809017, 0.500000, -0.309017),
    (-0.500000, 0.309017, -0.809017),
    (0.000000, -0.500000, -0.809017),
    (-0.809017, 0.000000, -0.500000),
    (0.000000, -1.000000, 0.000000),
    (0.809017, -0.500000, -0.309017),
    (0.500000, -0.309017, -0.809017),
    (0.500000, 0.309017, -0.809017),
    (0.309017, -0.809017, -0.500000),
    (0.500000, 0.000000, -0.809017),
    (0.309017, 0.809017, 0.500000),
    (0.809017, 0.500000, 0.309017),
    (0.500000, 0.309017, 0.809017),
    (0.000000, 0.500000, 0.809017),
    (-0.500000, 0.309017, 0.809017),
    (-0.309017, 0.809017, -0.500000),
    (0.000000, 0.809017, 0.500000),
    (0.809017, 0.500000, 0.309017),
    (0.809017, -0.500000, 0.309017),
    (0.309017, -0.809017, 0.500000),
    (0.000000, 0.000000, 1.539017),
    (-0.951056, -0.587785, 1.000000),
    (0.951056, -0.587785, 1.000000),
    (0.587785, 0.951056, 1.000000),
    (-0.587785, 0.951056, 1.000000),
    (0.000000, -1.175571, -0.381966),
    (-1.175571, 0.000000, -0.381966),
    (0.000000, 1.175571, -0.381966),
    (1.175571, 0.000000, -0.381966),
    (0.000000, -1.175571, 0.381966),
    (-0.726543, -0.951056, 0.381966),
    (0.726543, -0.951056, 0.381966),
    (-1.175571, 0.000000, 0.381966),
    (-0.726543, 0.951056, 0.381966),
    (0.726543, 0.951056, 0.381966),
    (1.175571, 0.000000, 0.381966),
    (0.000000, 0.000000, -1.539017),
    (0.951056, 0.587785, -1.000000),
    (-0.951056, 0.587785, -1.000000),
    (-0.587785, -0.951056, -1.000000),
]

faces = [
    (0, 1, 15), (1, 2, 15), (2, 3, 15), (3, 4, 15), (4, 0, 15),
    (8, 9, 21), (9, 10, 21), (10, 11, 21), (11, 12, 21), (12, 8, 21),
    (13, 14, 15), (14, 0, 15), (0, 4, 15), (4, 12, 15), (12, 13, 15),
    (16, 17, 27), (17, 2, 27), (2, 3, 27), (3, 24, 27), (24, 16, 27),
    (22, 23, 27), (23, 24, 27), (24, 25, 27), (25, 26, 27), (26, 22, 27),
    (1, 18, 33), (18, 29, 33), (29, 30, 33), (30, 31, 33), (31, 1, 33),
    (5, 6, 40), (6, 35, 40), (35, 34, 40), (34, 37, 40), (37, 5, 40),
    (19, 7, 33), (7, 30, 33), (30, 26, 33), (26, 32, 33), (32, 19, 33),
    (5, 39, 40), (39, 24, 40), (24, 3, 40), (3, 11, 40), (11, 5, 40),
    (6, 7, 40), (7, 19, 40), (19, 42, 40), (42, 35, 40), (35, 6, 40),
    (34, 36, 40), (36, 38, 40), (38, 11, 40), (11, 37, 40), (37, 34, 40),
    (8, 43, 21), (43, 14, 21), (14, 9, 21), (9, 0, 21), (0, 8, 21),
    (44, 45, 46), (44, 46, 47), (44, 47, 48),
    (49, 50, 51), (49, 51, 52), (49, 52, 53),
    (54, 55, 56), (54, 56, 49), (54, 49, 53),
    (57, 58, 59), (57, 59, 60), (57, 60, 44),
    (50, 54, 53), (50, 53, 61), (50, 61, 62),
    (51, 57, 44), (51, 44, 48), (51, 48, 63),
    (55, 49, 56), (55, 56, 57), (55, 57, 51),
    (58, 44, 60), (58, 60, 52), (58, 52, 50),
    (56, 49, 52), (56, 52, 61), (56, 61, 59),
    (53, 44, 48), (53, 48, 62), (53, 62, 51),
    (60, 49, 63), (60, 63, 55), (60, 55, 54),
    (61, 44, 47), (61, 47, 58), (61, 58, 50),
    (62, 49, 51), (62, 51, 57), (62, 57, 60),
    (63, 44, 46), (63, 46, 56), (63, 56, 59),
    (59, 49, 54), (59, 54, 55), (59, 55, 63),
    (47, 44, 45), (47, 45, 57), (47, 57, 61),
    (48, 49, 60), (48, 60, 53), (48, 53, 62),
    (46, 44, 61), (46, 61, 52), (46, 52, 59),
    (45, 49, 56), (45, 56, 63), (45, 63, 48),
]

DOD_FACES = 60

mesh = bpy.data.meshes.new("Stellated_Compound")
mesh.from_pydata(verts, [], faces)
mesh.update()

obj = bpy.data.objects.new("Stellated_Compound", mesh)
bpy.context.collection.objects.link(obj)
bpy.context.view_layer.objects.active = obj
obj.select_set(True)

# Vertex groups for coloring
# Materials
mat_dod = bpy.data.materials.new("DOD_Gold")
mat_dod.use_nodes = True
bsdf = mat_dod.node_tree.nodes["Principled BSDF"]
bsdf.inputs['Base Color'].default_value = (1.0, 0.84, 0.0, 1.0)
bsdf.inputs['Metallic'].default_value = 0.3

mat_ico = bpy.data.materials.new("ICO_Violet")
mat_ico.use_nodes = True
bsdf = mat_ico.node_tree.nodes["Principled BSDF"]
bsdf.inputs['Base Color'].default_value = (0.56, 0.0, 1.0, 1.0)
bsdf.inputs['Metallic'].default_value = 0.3

obj.data.materials.append(mat_dod)  # index 0
obj.data.materials.append(mat_ico)  # index 1

# Assign materials: DOD faces = 0..59, ICO faces = 60..119
for i, poly in enumerate(obj.data.polygons):
    poly.material_index = 0 if i < 60 else 1

# Shade flat for crisp faceted look
bpy.ops.object.shade_flat()

# Export STL
import os
stl_path = os.path.expanduser('~/Desktop/stellated_compound_violet_gold.stl')
try:
    bpy.ops.wm.stl_export(filepath=stl_path)
except:
    try:
        bpy.ops.export_mesh.stl(filepath=stl_path)
    except:
        pass

print(f"STL exported to {stl_path}")
print("=== STELLATED COMPOUND (VIOLET & GOLD) COMPLETE ===")
