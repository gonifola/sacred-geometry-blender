import bpy
from mathutils import Vector

# Clear scene
bpy.ops.object.select_all(action='SELECT')
bpy.ops.object.delete(use_global=True)

# ===== PRE-COMPUTED COMPOUND GEOMETRY (SHORT SPIKES) =====
# DOD edge = 1.000000, ICO edge = 1.618034
# TIP_DOD = 1.618034 (phi), TIP_ICO = 1.618034 (phi) -- SHORT VERSION
# Both tip sets at same radius -- compact, stubby icosahedron spikes
# 64 verts (shared), 120 faces (60 DOD + 60 ICO)

verts = [
    (-0.8090169944, -0.8090169944, -0.8090169944),
    (-0.8090169944, -0.8090169944, 0.8090169944),
    (-0.8090169944, 0.8090169944, -0.8090169944),
    (-0.8090169944, 0.8090169944, 0.8090169944),
    (0.8090169944, -0.8090169944, -0.8090169944),
    (0.8090169944, -0.8090169944, 0.8090169944),
    (0.8090169944, 0.8090169944, -0.8090169944),
    (0.8090169944, 0.8090169944, 0.8090169944),
    (0.0000000000, -1.3090169944, -0.5000000000),
    (0.0000000000, -1.3090169944, 0.5000000000),
    (0.0000000000, 1.3090169944, -0.5000000000),
    (0.0000000000, 1.3090169944, 0.5000000000),
    (-0.5000000000, 0.0000000000, -1.3090169944),
    (0.5000000000, 0.0000000000, -1.3090169944),
    (-0.5000000000, 0.0000000000, 1.3090169944),
    (0.5000000000, 0.0000000000, 1.3090169944),
    (-1.3090169944, -0.5000000000, 0.0000000000),
    (-1.3090169944, 0.5000000000, 0.0000000000),
    (1.3090169944, -0.5000000000, 0.0000000000),
    (1.3090169944, 0.5000000000, 0.0000000000),
    (0.0000000000, 0.8506508084, -1.3763819205),
    (1.3763819205, 0.0000000000, 0.8506508084),
    (-0.8506508084, -1.3763819205, 0.0000000000),
    (1.3763819205, -0.0000000000, -0.8506508084),
    (0.8506508084, -1.3763819205, 0.0000000000),
    (-0.0000000000, -0.8506508084, 1.3763819205),
    (0.0000000000, -0.8506508084, -1.3763819205),
    (0.0000000000, 0.8506508084, 1.3763819205),
    (-1.3763819205, 0.0000000000, 0.8506508084),
    (-0.8506508084, 1.3763819205, 0.0000000000),
    (0.8506508084, 1.3763819205, 0.0000000000),
    (-1.3763819205, 0.0000000000, -0.8506508084),
    (0.0000000000, -0.8090169944, -1.3090169944),
    (0.0000000000, -0.8090169944, 1.3090169944),
    (0.0000000000, 0.8090169944, -1.3090169944),
    (0.0000000000, 0.8090169944, 1.3090169944),
    (-1.3090169944, 0.0000000000, -0.8090169944),
    (1.3090169944, 0.0000000000, -0.8090169944),
    (-1.3090169944, 0.0000000000, 0.8090169944),
    (1.3090169944, 0.0000000000, 0.8090169944),
    (-0.8090169944, -1.3090169944, 0.0000000000),
    (-0.8090169944, 1.3090169944, 0.0000000000),
    (0.8090169944, -1.3090169944, 0.0000000000),
    (0.8090169944, 1.3090169944, 0.0000000000),
    (-0.9341723590, -0.9341723590, -0.9341723590),
    (-0.9341723590, 0.9341723590, -0.9341723590),
    (0.5773502692, 0.0000000000, -1.5115226282),
    (-0.5773502692, 0.0000000000, -1.5115226282),
    (0.0000000000, -1.5115226282, 0.5773502692),
    (0.9341723590, -0.9341723590, -0.9341723590),
    (0.0000000000, -1.5115226282, -0.5773502692),
    (-1.5115226282, 0.5773502692, 0.0000000000),
    (-1.5115226282, -0.5773502692, 0.0000000000),
    (-0.9341723590, -0.9341723590, 0.9341723590),
    (-0.5773502692, 0.0000000000, 1.5115226282),
    (-0.9341723590, 0.9341723590, 0.9341723590),
    (0.0000000000, 1.5115226282, 0.5773502692),
    (0.0000000000, 1.5115226282, -0.5773502692),
    (0.9341723590, 0.9341723590, -0.9341723590),
    (1.5115226282, -0.5773502692, 0.0000000000),
    (0.5773502692, 0.0000000000, 1.5115226282),
    (0.9341723590, -0.9341723590, 0.9341723590),
    (0.9341723590, 0.9341723590, 0.9341723590),
    (1.5115226282, 0.5773502692, 0.0000000000),
]

faces = [
    (2, 10, 20),
    (10, 6, 20),
    (6, 13, 20),
    (13, 12, 20),
    (12, 2, 20),
    (18, 19, 21),
    (19, 7, 21),
    (7, 15, 21),
    (15, 5, 21),
    (5, 18, 21),
    (8, 9, 22),
    (9, 1, 22),
    (1, 16, 22),
    (16, 0, 22),
    (0, 8, 22),
    (13, 6, 23),
    (6, 19, 23),
    (19, 18, 23),
    (18, 4, 23),
    (4, 13, 23),
    (4, 18, 24),
    (18, 5, 24),
    (5, 9, 24),
    (9, 8, 24),
    (8, 4, 24),
    (9, 5, 25),
    (5, 15, 25),
    (15, 14, 25),
    (14, 1, 25),
    (1, 9, 25),
    (12, 13, 26),
    (13, 4, 26),
    (4, 8, 26),
    (8, 0, 26),
    (0, 12, 26),
    (3, 14, 27),
    (14, 15, 27),
    (15, 7, 27),
    (7, 11, 27),
    (11, 3, 27),
    (1, 14, 28),
    (14, 3, 28),
    (3, 17, 28),
    (17, 16, 28),
    (16, 1, 28),
    (2, 17, 29),
    (17, 3, 29),
    (3, 11, 29),
    (11, 10, 29),
    (10, 2, 29),
    (6, 10, 30),
    (10, 11, 30),
    (11, 7, 30),
    (7, 19, 30),
    (19, 6, 30),
    (16, 17, 31),
    (17, 2, 31),
    (2, 12, 31),
    (12, 0, 31),
    (0, 16, 31),
    (32, 40, 44),
    (40, 36, 44),
    (36, 32, 44),
    (34, 41, 45),
    (41, 36, 45),
    (36, 34, 45),
    (34, 32, 46),
    (32, 37, 46),
    (37, 34, 46),
    (34, 32, 47),
    (32, 36, 47),
    (36, 34, 47),
    (42, 33, 48),
    (33, 40, 48),
    (40, 42, 48),
    (42, 32, 49),
    (32, 37, 49),
    (37, 42, 49),
    (42, 32, 50),
    (32, 40, 50),
    (40, 42, 50),
    (38, 41, 51),
    (41, 36, 51),
    (36, 38, 51),
    (38, 40, 52),
    (40, 36, 52),
    (36, 38, 52),
    (38, 33, 53),
    (33, 40, 53),
    (40, 38, 53),
    (38, 35, 54),
    (35, 33, 54),
    (33, 38, 54),
    (38, 35, 55),
    (35, 41, 55),
    (41, 38, 55),
    (43, 35, 56),
    (35, 41, 56),
    (41, 43, 56),
    (43, 34, 57),
    (34, 41, 57),
    (41, 43, 57),
    (43, 34, 58),
    (34, 37, 58),
    (37, 43, 58),
    (39, 42, 59),
    (42, 37, 59),
    (37, 39, 59),
    (39, 35, 60),
    (35, 33, 60),
    (33, 39, 60),
    (39, 42, 61),
    (42, 33, 61),
    (33, 39, 61),
    (39, 43, 62),
    (43, 35, 62),
    (35, 39, 62),
    (39, 43, 63),
    (43, 37, 63),
    (37, 39, 63),
]

# Create mesh and object
mesh = bpy.data.meshes.new("Compound_Short")
mesh.from_pydata(verts, [], faces)
mesh.update(calc_edges=True)
mesh.validate(verbose=True)

obj = bpy.data.objects.new("Stellated_Compound_Short", mesh)
bpy.context.collection.objects.link(obj)
bpy.context.view_layer.objects.active = obj
obj.select_set(True)

# Materials
mat_dod = bpy.data.materials.new("DOD_Gold")
mat_dod.use_nodes = True
bsdf = mat_dod.node_tree.nodes["Principled BSDF"]
bsdf.inputs['Base Color'].default_value = (1.0, 0.84, 0.0, 1.0)
bsdf.inputs['Metallic'].default_value = 0.3

mat_ico = bpy.data.materials.new("ICO_Blue")
mat_ico.use_nodes = True
bsdf = mat_ico.node_tree.nodes["Principled BSDF"]
bsdf.inputs['Base Color'].default_value = (0.2, 0.5, 1.0, 1.0)
bsdf.inputs['Metallic'].default_value = 0.3

obj.data.materials.append(mat_dod)  # index 0
obj.data.materials.append(mat_ico)  # index 1

# Assign materials: DOD faces = 0..59, ICO faces = 60..119
for i, poly in enumerate(obj.data.polygons):
    poly.material_index = 0 if i < 60 else 1

bpy.ops.object.shade_flat()

# Export STL
import os
stl_path = os.path.expanduser('~/Desktop/stellated_compound_short_spikes.stl')
try:
    bpy.ops.wm.stl_export(filepath=stl_path)
except:
    bpy.ops.export_mesh.stl(filepath=stl_path)
print(f'STL exported to {stl_path}')

print('=== SHORT SPIKE COMPOUND DONE ===')
print(f'Verts: {len(obj.data.vertices)}, Faces: {len(obj.data.polygons)}')
