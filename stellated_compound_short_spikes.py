import bpy
import bmesh
from mathutils import Vector

# Clear scene
bpy.ops.object.select_all(action='SELECT')
bpy.ops.object.delete(use_global=True)

# ===== PRE-COMPUTED COMPOUND GEOMETRY (SHORT SPIKES) =====
# DOD edge = 1.000000, ICO edge = 1.618034
# TIP_DOD = 1.618034 (phi), TIP_ICO = 1.618034 (phi) -- SHORT VERSION
# Both tip sets at same radius -- compact, stubby icosahedron spikes
# 12 pentagon faces (60 tris), 20 triangle faces (60 tris)

verts = [
    (0.5000000000, -1.3090169944, 0.0000000000),
    (-0.5000000000, -1.3090169944, 0.0000000000),
    (-0.8090169944, -0.8090169944, -0.8090169944),
    (0.0000000000, -0.5000000000, -1.3090169944),
    (0.8090169944, -0.8090169944, -0.8090169944),
    (0.0000000000, -1.3763819205, -0.8506508084),
    (0.0000000000, 0.5000000000, -1.3090169944),
    (0.0000000000, -0.5000000000, -1.3090169944),
    (-0.8090169944, -0.8090169944, -0.8090169944),
    (-1.3090169944, 0.0000000000, -0.5000000000),
    (-0.8090169944, 0.8090169944, -0.8090169944),
    (-0.8506508084, 0.0000000000, -1.3763819205),
    (-1.3090169944, 0.0000000000, 0.5000000000),
    (-1.3090169944, 0.0000000000, -0.5000000000),
    (-0.8090169944, -0.8090169944, -0.8090169944),
    (-0.5000000000, -1.3090169944, 0.0000000000),
    (-0.8090169944, -0.8090169944, 0.8090169944),
    (-1.3763819205, -0.8506508084, 0.0000000000),
    (0.8090169944, -0.8090169944, 0.8090169944),
    (0.0000000000, -0.5000000000, 1.3090169944),
    (-0.8090169944, -0.8090169944, 0.8090169944),
    (-0.5000000000, -1.3090169944, 0.0000000000),
    (0.5000000000, -1.3090169944, 0.0000000000),
    (0.0000000000, -1.3763819205, 0.8506508084),
    (-0.8090169944, 0.8090169944, 0.8090169944),
    (-1.3090169944, 0.0000000000, 0.5000000000),
    (-0.8090169944, -0.8090169944, 0.8090169944),
    (0.0000000000, -0.5000000000, 1.3090169944),
    (0.0000000000, 0.5000000000, 1.3090169944),
    (-0.8506508084, 0.0000000000, 1.3763819205),
    (-0.8090169944, 0.8090169944, 0.8090169944),
    (-0.5000000000, 1.3090169944, 0.0000000000),
    (-0.8090169944, 0.8090169944, -0.8090169944),
    (-1.3090169944, 0.0000000000, -0.5000000000),
    (-1.3090169944, 0.0000000000, 0.5000000000),
    (-1.3763819205, 0.8506508084, 0.0000000000),
    (0.8090169944, 0.8090169944, -0.8090169944),
    (0.0000000000, 0.5000000000, -1.3090169944),
    (-0.8090169944, 0.8090169944, -0.8090169944),
    (-0.5000000000, 1.3090169944, 0.0000000000),
    (0.5000000000, 1.3090169944, 0.0000000000),
    (0.0000000000, 1.3763819205, -0.8506508084),
    (0.5000000000, 1.3090169944, 0.0000000000),
    (-0.5000000000, 1.3090169944, 0.0000000000),
    (-0.8090169944, 0.8090169944, 0.8090169944),
    (0.0000000000, 0.5000000000, 1.3090169944),
    (0.8090169944, 0.8090169944, 0.8090169944),
    (0.0000000000, 1.3763819205, 0.8506508084),
    (0.8090169944, 0.8090169944, -0.8090169944),
    (1.3090169944, 0.0000000000, -0.5000000000),
    (0.8090169944, -0.8090169944, -0.8090169944),
    (0.0000000000, -0.5000000000, -1.3090169944),
    (0.0000000000, 0.5000000000, -1.3090169944),
    (0.8506508084, 0.0000000000, -1.3763819205),
    (0.8090169944, -0.8090169944, 0.8090169944),
    (0.5000000000, -1.3090169944, 0.0000000000),
    (0.8090169944, -0.8090169944, -0.8090169944),
    (1.3090169944, 0.0000000000, -0.5000000000),
    (1.3090169944, 0.0000000000, 0.5000000000),
    (1.3763819205, -0.8506508084, 0.0000000000),
    (0.0000000000, 0.5000000000, 1.3090169944),
    (0.0000000000, -0.5000000000, 1.3090169944),
    (0.8090169944, -0.8090169944, 0.8090169944),
    (1.3090169944, 0.0000000000, 0.5000000000),
    (0.8090169944, 0.8090169944, 0.8090169944),
    (0.8506508084, 0.0000000000, 1.3763819205),
    (1.3090169944, 0.0000000000, 0.5000000000),
    (1.3090169944, 0.0000000000, -0.5000000000),
    (0.8090169944, 0.8090169944, -0.8090169944),
    (0.5000000000, 1.3090169944, 0.0000000000),
    (0.8090169944, 0.8090169944, 0.8090169944),
    (1.3763819205, 0.8506508084, 0.0000000000),
    (0.0000000000, -0.8090169944, -1.3090169944),
    (-0.8090169944, -1.3090169944, 0.0000000000),
    (-1.3090169944, 0.0000000000, -0.8090169944),
    (-0.9341723590, -0.9341723590, -0.9341723590),
    (0.0000000000, -0.8090169944, -1.3090169944),
    (-1.3090169944, 0.0000000000, -0.8090169944),
    (0.0000000000, 0.8090169944, -1.3090169944),
    (-0.5773502692, 0.0000000000, -1.5115226282),
    (0.0000000000, -0.8090169944, -1.3090169944),
    (0.8090169944, -1.3090169944, 0.0000000000),
    (-0.8090169944, -1.3090169944, 0.0000000000),
    (0.0000000000, -1.5115226282, -0.5773502692),
    (0.0000000000, -0.8090169944, -1.3090169944),
    (0.0000000000, 0.8090169944, -1.3090169944),
    (1.3090169944, 0.0000000000, -0.8090169944),
    (0.5773502692, 0.0000000000, -1.5115226282),
    (0.0000000000, -0.8090169944, -1.3090169944),
    (1.3090169944, 0.0000000000, -0.8090169944),
    (0.8090169944, -1.3090169944, 0.0000000000),
    (0.9341723590, -0.9341723590, -0.9341723590),
    (-1.3090169944, 0.0000000000, -0.8090169944),
    (-0.8090169944, -1.3090169944, 0.0000000000),
    (-1.3090169944, 0.0000000000, 0.8090169944),
    (-1.5115226282, -0.5773502692, 0.0000000000),
    (-1.3090169944, 0.0000000000, -0.8090169944),
    (-1.3090169944, 0.0000000000, 0.8090169944),
    (-0.8090169944, 1.3090169944, 0.0000000000),
    (-1.5115226282, 0.5773502692, 0.0000000000),
    (-1.3090169944, 0.0000000000, -0.8090169944),
    (-0.8090169944, 1.3090169944, 0.0000000000),
    (0.0000000000, 0.8090169944, -1.3090169944),
    (-0.9341723590, 0.9341723590, -0.9341723590),
    (-0.8090169944, -1.3090169944, 0.0000000000),
    (0.8090169944, -1.3090169944, 0.0000000000),
    (0.0000000000, -0.8090169944, 1.3090169944),
    (0.0000000000, -1.5115226282, 0.5773502692),
    (-0.8090169944, -1.3090169944, 0.0000000000),
    (0.0000000000, -0.8090169944, 1.3090169944),
    (-1.3090169944, 0.0000000000, 0.8090169944),
    (-0.9341723590, -0.9341723590, 0.9341723590),
    (0.0000000000, -0.8090169944, 1.3090169944),
    (0.0000000000, 0.8090169944, 1.3090169944),
    (-1.3090169944, 0.0000000000, 0.8090169944),
    (-0.5773502692, 0.0000000000, 1.5115226282),
    (0.0000000000, -0.8090169944, 1.3090169944),
    (0.8090169944, -1.3090169944, 0.0000000000),
    (1.3090169944, 0.0000000000, 0.8090169944),
    (0.9341723590, -0.9341723590, 0.9341723590),
    (0.0000000000, -0.8090169944, 1.3090169944),
    (1.3090169944, 0.0000000000, 0.8090169944),
    (0.0000000000, 0.8090169944, 1.3090169944),
    (0.5773502692, 0.0000000000, 1.5115226282),
    (-1.3090169944, 0.0000000000, 0.8090169944),
    (0.0000000000, 0.8090169944, 1.3090169944),
    (-0.8090169944, 1.3090169944, 0.0000000000),
    (-0.9341723590, 0.9341723590, 0.9341723590),
    (-0.8090169944, 1.3090169944, 0.0000000000),
    (0.8090169944, 1.3090169944, 0.0000000000),
    (0.0000000000, 0.8090169944, -1.3090169944),
    (0.0000000000, 1.5115226282, -0.5773502692),
    (-0.8090169944, 1.3090169944, 0.0000000000),
    (0.0000000000, 0.8090169944, 1.3090169944),
    (0.8090169944, 1.3090169944, 0.0000000000),
    (0.0000000000, 1.5115226282, 0.5773502692),
    (0.0000000000, 0.8090169944, -1.3090169944),
    (0.8090169944, 1.3090169944, 0.0000000000),
    (1.3090169944, 0.0000000000, -0.8090169944),
    (0.9341723590, 0.9341723590, -0.9341723590),
    (1.3090169944, 0.0000000000, -0.8090169944),
    (1.3090169944, 0.0000000000, 0.8090169944),
    (0.8090169944, -1.3090169944, 0.0000000000),
    (1.5115226282, -0.5773502692, 0.0000000000),
    (1.3090169944, 0.0000000000, -0.8090169944),
    (0.8090169944, 1.3090169944, 0.0000000000),
    (1.3090169944, 0.0000000000, 0.8090169944),
    (1.5115226282, 0.5773502692, 0.0000000000),
    (0.0000000000, 0.8090169944, 1.3090169944),
    (1.3090169944, 0.0000000000, 0.8090169944),
    (0.8090169944, 1.3090169944, 0.0000000000),
    (0.9341723590, 0.9341723590, 0.9341723590),
]

faces = [
    (0, 1, 5),
    (1, 2, 5),
    (2, 3, 5),
    (3, 4, 5),
    (4, 0, 5),
    (6, 7, 11),
    (7, 8, 11),
    (8, 9, 11),
    (9, 10, 11),
    (10, 6, 11),
    (12, 13, 17),
    (13, 14, 17),
    (14, 15, 17),
    (15, 16, 17),
    (16, 12, 17),
    (18, 19, 23),
    (19, 20, 23),
    (20, 21, 23),
    (21, 22, 23),
    (22, 18, 23),
    (24, 25, 29),
    (25, 26, 29),
    (26, 27, 29),
    (27, 28, 29),
    (28, 24, 29),
    (30, 31, 35),
    (31, 32, 35),
    (32, 33, 35),
    (33, 34, 35),
    (34, 30, 35),
    (36, 37, 41),
    (37, 38, 41),
    (38, 39, 41),
    (39, 40, 41),
    (40, 36, 41),
    (42, 43, 47),
    (43, 44, 47),
    (44, 45, 47),
    (45, 46, 47),
    (46, 42, 47),
    (48, 49, 53),
    (49, 50, 53),
    (50, 51, 53),
    (51, 52, 53),
    (52, 48, 53),
    (54, 55, 59),
    (55, 56, 59),
    (56, 57, 59),
    (57, 58, 59),
    (58, 54, 59),
    (60, 61, 65),
    (61, 62, 65),
    (62, 63, 65),
    (63, 64, 65),
    (64, 60, 65),
    (66, 67, 71),
    (67, 68, 71),
    (68, 69, 71),
    (69, 70, 71),
    (70, 66, 71),
    (72, 73, 75),
    (73, 74, 75),
    (74, 72, 75),
    (76, 77, 79),
    (77, 78, 79),
    (78, 76, 79),
    (80, 81, 83),
    (81, 82, 83),
    (82, 80, 83),
    (84, 85, 87),
    (85, 86, 87),
    (86, 84, 87),
    (88, 89, 91),
    (89, 90, 91),
    (90, 88, 91),
    (92, 93, 95),
    (93, 94, 95),
    (94, 92, 95),
    (96, 97, 99),
    (97, 98, 99),
    (98, 96, 99),
    (100, 101, 103),
    (101, 102, 103),
    (102, 100, 103),
    (104, 105, 107),
    (105, 106, 107),
    (106, 104, 107),
    (108, 109, 111),
    (109, 110, 111),
    (110, 108, 111),
    (112, 113, 115),
    (113, 114, 115),
    (114, 112, 115),
    (116, 117, 119),
    (117, 118, 119),
    (118, 116, 119),
    (120, 121, 123),
    (121, 122, 123),
    (122, 120, 123),
    (124, 125, 127),
    (125, 126, 127),
    (126, 124, 127),
    (128, 129, 131),
    (129, 130, 131),
    (130, 128, 131),
    (132, 133, 135),
    (133, 134, 135),
    (134, 132, 135),
    (136, 137, 139),
    (137, 138, 139),
    (138, 136, 139),
    (140, 141, 143),
    (141, 142, 143),
    (142, 140, 143),
    (144, 145, 147),
    (145, 146, 147),
    (146, 144, 147),
    (148, 149, 151),
    (149, 150, 151),
    (150, 148, 151),
]

# Create mesh and object
mesh = bpy.data.meshes.new("Compound_Short")
mesh.from_pydata(verts, [], faces)
mesh.update(calc_edges=True)
mesh.validate(verbose=True)

obj = bpy.data.objects.new("Stellated_Compound_Short", mesh)
bpy.context.collection.objects.link(obj)
bpy.context.view_layer.objects.active = obj
obj.select_set(True)

# Vertex groups for coloring
dod_vg = obj.vertex_groups.new(name='Dodecahedron')
ico_vg = obj.vertex_groups.new(name='Icosahedron')

# Materials
mat_dod = bpy.data.materials.new("DOD_Gold")
mat_dod.use_nodes = True
bsdf = mat_dod.node_tree.nodes["Principled BSDF"]
bsdf.inputs['Base Color'].default_value = (1.0, 0.84, 0.0, 1.0)
bsdf.inputs['Metallic'].default_value = 0.3

mat_ico = bpy.data.materials.new("ICO_Blue")
mat_ico.use_nodes = True
bsdf = mat_ico.node_tree.nodes["Principled BSDF"]
bsdf.inputs['Base Color'].default_value = (0.2, 0.5, 1.0, 1.0)
bsdf.inputs['Metallic'].default_value = 0.3

obj.data.materials.append(mat_dod)  # index 0
obj.data.materials.append(mat_ico)  # index 1

# Assign materials: DOD faces = 0..59, ICO faces = 60..119
for i, poly in enumerate(obj.data.polygons):
    poly.material_index = 0 if i < 60 else 1

# Shade flat for crisp faceted look
bpy.ops.object.shade_flat()

# Export STL
import os
stl_path = os.path.expanduser('~/Desktop/stellated_compound_short_spikes.stl')
try:
    bpy.ops.wm.stl_export(filepath=stl_path)
except:
    bpy.ops.export_mesh.stl(filepath=stl_path)
print(f'STL exported to {stl_path}')

print('=== SHORT SPIKE COMPOUND COMPLETE ===')
print(f'Verts: {len(obj.data.vertices)}, Faces: {len(obj.data.polygons)}')
print('TIP_DOD = phi (1.618), TIP_ICO = phi (1.618) -- both at same radius')
