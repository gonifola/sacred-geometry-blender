import bpy
import bmesh
from mathutils import Vector

# Clear scene
bpy.ops.object.select_all(action='SELECT')
bpy.ops.object.delete(use_global=True)

# ===== PRE-COMPUTED COMPOUND GEOMETRY =====
# DOD edge = 1.000000, ICO edge = 1.618034
# TIP_DOD = 1.618034, TIP_ICO = 1.618034 -- SHORT VERSION
# Both tip sets at same radius -- compact, stubby icosahedron spikes
# 12 pentagon faces (60 tris), 20 triangle faces (60 tris)

verts = [
    (-0.8090169944, -0.8090169944, -0.8090169944),
    (-0.8090169944, -0.8090169944, 0.8090169944),
    (-0.8090169944, 0.8090169944, -0.8090169944),
    (-0.8090169944, 0.8090169944, 0.8090169944),
    (0.8090169944, -0.8090169944, -0.8090169944),
    (0.8090169944, -0.8090169944, 0.8090169944),
    (0.8090169944, 0.8090169944, -0.8090169944),
    (0.8090169944, 0.8090169944, 0.8090169944),
    (0.0000000000, -1.3090169944, -0.5000000000),
    (-0.5000000000, 0.0000000000, -1.3090169944),
    (-1.3090169944, -0.5000000000, 0.0000000000),
    (0.0000000000, -1.3090169944, 0.5000000000),
    (0.5000000000, 0.0000000000, -1.3090169944),
    (-1.3090169944, 0.5000000000, 0.0000000000),
    (0.0000000000, 1.3090169944, -0.5000000000),
    (-0.5000000000, 0.0000000000, 1.3090169944),
    (1.3090169944, -0.5000000000, 0.0000000000),
    (0.0000000000, 1.3090169944, 0.5000000000),
    (0.5000000000, 0.0000000000, 1.3090169944),
    (1.3090169944, 0.5000000000, 0.0000000000),
    (0.0000000000, 1.4360610050, 2.3235955160),
    (2.3235955160, 0.0000000000, 1.4360610050),
    (1.4360610050, 2.3235955160, 0.0000000000),
    (0.0000000000, -1.4360610050, 2.3235955160),
    (2.3235955160, 0.0000000000, -1.4360610050),
    (-2.3235955160, 0.0000000000, 1.4360610050),
    (-2.3235955160, 0.0000000000, -1.4360610050),
    (0.0000000000, -1.4360610050, -2.3235955160),
    (-1.4360610050, -2.3235955160, 0.0000000000),
    (0.0000000000, 1.4360610050, -2.3235955160),
    (-1.4360610050, 2.3235955160, 0.0000000000),
    (1.4360610050, -2.3235955160, 0.0000000000),
    (0.0000000000, -0.8090169944, -1.3090169944),
    (-1.3090169944, 0.0000000000, -0.8090169944),
    (-0.8090169944, -1.3090169944, 0.0000000000),
    (0.0000000000, -0.8090169944, 1.3090169944),
    (1.3090169944, 0.0000000000, -0.8090169944),
    (-0.8090169944, 1.3090169944, 0.0000000000),
    (0.0000000000, 0.8090169944, -1.3090169944),
    (-1.3090169944, 0.0000000000, 0.8090169944),
    (0.8090169944, -1.3090169944, 0.0000000000),
    (0.0000000000, 0.8090169944, 1.3090169944),
    (1.3090169944, 0.0000000000, 0.8090169944),
    (0.8090169944, 1.3090169944, 0.0000000000),
    (1.5770613317, -1.5770613317, -1.5770613317),
    (0.9746775053, 0.0000000000, 2.5517388371),
    (-2.5517388371, 0.9746775053, 0.0000000000),
    (2.5517388371, 0.9746775053, 0.0000000000),
    (0.0000000000, 2.5517388371, -0.9746775053),
    (-0.9746775053, 0.0000000000, -2.5517388371),
    (-0.9746775053, 0.0000000000, 2.5517388371),
    (-1.5770613317, 1.5770613317, 1.5770613317),
    (1.5770613317, -1.5770613317, 1.5770613317),
    (-1.5770613317, 1.5770613317, -1.5770613317),
    (2.5517388371, -0.9746775053, 0.0000000000),
    (-1.5770613317, -1.5770613317, -1.5770613317),
    (-2.5517388371, -0.9746775053, 0.0000000000),
    (0.0000000000, -2.5517388371, 0.9746775053),
    (1.5770613317, 1.5770613317, 1.5770613317),
    (0.9746775053, 0.0000000000, -2.5517388371),
    (0.0000000000, 2.5517388371, 0.9746775053),
    (1.5770613317, 1.5770613317, -1.5770613317),
    (-1.5770613317, -1.5770613317, 1.5770613317),
    (0.0000000000, -2.5517388371, -0.9746775053),
]

faces = [
    (3, 15, 20),
    (15, 18, 20),
    (18, 7, 20),
    (7, 17, 20),
    (17, 3, 20),
    (5, 16, 21),
    (16, 19, 21),
    (19, 7, 21),
    (7, 18, 21),
    (18, 5, 21),
    (6, 14, 22),
    (14, 17, 22),
    (17, 7, 22),
    (7, 19, 22),
    (19, 6, 22),
    (1, 11, 23),
    (11, 5, 23),
    (5, 18, 23),
    (18, 15, 23),
    (15, 1, 23),
    (4, 12, 24),
    (12, 6, 24),
    (6, 19, 24),
    (19, 16, 24),
    (16, 4, 24),
    (1, 25, 10),
    (10, 25, 13),
    (13, 25, 3),
    (3, 25, 15),
    (15, 25, 1),
    (0, 26, 9),
    (9, 26, 2),
    (2, 26, 13),
    (13, 26, 10),
    (10, 26, 0),
    (0, 27, 8),
    (8, 27, 4),
    (4, 27, 12),
    (12, 27, 9),
    (9, 27, 0),
    (0, 8, 28),
    (8, 11, 28),
    (11, 1, 28),
    (1, 10, 28),
    (10, 0, 28),
    (2, 29, 9),
    (9, 29, 12),
    (12, 29, 6),
    (6, 29, 14),
    (14, 29, 2),
    (2, 13, 30),
    (13, 3, 30),
    (3, 17, 30),
    (17, 14, 30),
    (14, 2, 30),
    (4, 31, 8),
    (8, 31, 11),
    (11, 31, 5),
    (5, 31, 16),
    (16, 31, 4),
    (32, 36, 44),
    (36, 40, 44),
    (40, 32, 44),
    (35, 45, 41),
    (41, 45, 42),
    (42, 45, 35),
    (33, 46, 37),
    (37, 46, 39),
    (39, 46, 33),
    (36, 47, 42),
    (42, 47, 43),
    (43, 47, 36),
    (37, 48, 38),
    (38, 48, 43),
    (43, 48, 37),
    (32, 33, 49),
    (33, 38, 49),
    (38, 32, 49),
    (35, 50, 39),
    (39, 50, 41),
    (41, 50, 35),
    (37, 39, 51),
    (39, 41, 51),
    (41, 37, 51),
    (35, 40, 52),
    (40, 42, 52),
    (42, 35, 52),
    (33, 37, 53),
    (37, 38, 53),
    (38, 33, 53),
    (36, 54, 40),
    (40, 54, 42),
    (42, 54, 36),
    (32, 55, 33),
    (33, 55, 34),
    (34, 55, 32),
    (33, 34, 56),
    (34, 39, 56),
    (39, 33, 56),
    (34, 57, 35),
    (35, 57, 40),
    (40, 57, 34),
    (41, 42, 58),
    (42, 43, 58),
    (43, 41, 58),
    (32, 59, 36),
    (36, 59, 38),
    (38, 59, 32),
    (37, 41, 60),
    (41, 43, 60),
    (43, 37, 60),
    (36, 38, 61),
    (38, 43, 61),
    (43, 36, 61),
    (34, 35, 62),
    (35, 39, 62),
    (39, 34, 62),
    (32, 63, 34),
    (34, 63, 40),
    (40, 63, 32),
]

# Create mesh and object
mesh = bpy.data.meshes.new("Compound_Short")
mesh.from_pydata(verts, [], faces)
mesh.update(calc_edges=True)
mesh.validate(verbose=True)

obj = bpy.data.objects.new("Stellated_Compound_Short", mesh)
bpy.context.collection.objects.link(obj)
bpy.context.view_layer.objects.active = obj
obj.select_set(True)

# Vertex groups for coloring
dod_vg = obj.vertex_groups.new(name='Dodecahedron')
ico_vg = obj.vertex_groups.new(name='Icosahedron')
dod_vg.add(list(range(0, 32)), 1.0, 'ADD')  # DOD verts
ico_vg.add(list(range(32, 64)), 1.0, 'ADD')  # ICO verts

# Materials
mat_dod = bpy.data.materials.new("DOD_Gold")
mat_dod.use_nodes = True
bsdf = mat_dod.node_tree.nodes["Principled BSDF"]
bsdf.inputs['Base Color'].default_value = (1.0, 0.84, 0.0, 1.0)
bsdf.inputs['Metallic'].default_value = 0.3

mat_ico = bpy.data.materials.new("ICO_Blue")
mat_ico.use_nodes = True
bsdf = mat_ico.node_tree.nodes["Principled BSDF"]
bsdf.inputs['Base Color'].default_value = (0.2, 0.5, 1.0, 1.0)
bsdf.inputs['Metallic'].default_value = 0.3

obj.data.materials.append(mat_dod)  # index 0
obj.data.materials.append(mat_ico)  # index 1

# Assign materials: DOD faces = 0..59, ICO faces = 60..119
for i, poly in enumerate(obj.data.polygons):
    poly.material_index = 0 if i < 60 else 1

# Shade flat for crisp faceted look
bpy.ops.object.shade_flat()

# Export STL
import os
stl_path = os.path.expanduser('~/Desktop/stellated_compound_short_spikes.stl')
try:
    bpy.ops.wm.stl_export(filepath=stl_path)
except:
    bpy.ops.export_mesh.stl(filepath=stl_path)
print(f'STL exported to {stl_path}')

print('=== SHORT SPIKE COMPOUND DONE ===')
print(f'Verts: {len(obj.data.vertices)}, Faces: {len(obj.data.polygons)}')
